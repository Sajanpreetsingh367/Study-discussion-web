<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Study Discussion Club</title>

<!-- React + Babel -->
<script src="https://unpkg.com/react@18/umd/react.development.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

<!-- Firebase Modular SDK -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

const firebaseConfig = {
apiKey: "AIzaSyDwbIHTMWM_AQ-NlsdXGDzAfoC8Tf8lZiY",
authDomain: "study-discussion-club.firebaseapp.com",
projectId: "study-discussion-club",
storageBucket: "study-discussion-club.appspot.com",
messagingSenderId: "383378613377",
appId: "1:383378613377:web:3b932c6b42076352811980",
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
window._firebase = { auth, db, createUserWithEmailAndPassword, signInWithEmailAndPassword, doc, setDoc };
</script>

<!-- Supabase for contest quiz -->
<script type="module">
import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm";
const supabaseUrl = "https://zkqegvyxmtwyznizuhjt.supabase.co";
const supabaseKey = "YOUR_ANON_PUBLIC_KEY";
window._supabase = createClient(supabaseUrl, supabaseKey);
</script>

<style>
body {margin:0;font-family:'Segoe UI',Arial,sans-serif;}
input, select, button {width:100%;padding:10px;margin-top:10px;border-radius:8px;border:1px solid #ccc;}
button {cursor:pointer;font-weight:bold;color:white;border:none;}
.container {display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:100vh;text-align:center;padding:20px;}
.exam-box, .menu-btn, .image-frame {padding:15px;border-radius:10px;margin:8px;width:90%;max-width:400px;border:1px solid #ccc;cursor:pointer;background-color:#fff;}
.image-frame img {width:100%;border:2px solid #007AFF;border-radius:8px;}
.back-button {position:absolute;top:20px;left:20px;cursor:pointer;font-size:20px;}
.section-title {font-weight:bold;padding:8px;margin-bottom:10px;border-radius:8px;border:1px solid #007AFF;}
.notice-box {background:#f0f0f0;padding:12px;border-radius:10px;margin-top:10px;font-size:14px;color:#333;}
</style>
</head>
<body>
<div id="root"></div>

<script type="text/babel">
const { useState, useEffect } = React;

function App() {
  const [screen, setScreen] = useState("welcome");
  const [signupData, setSignupData] = useState({username:"",email:"",password:"",mobile:"",pin:""});
  const [loginData, setLoginData] = useState({email:"",password:""});
  const [selectedExam, setSelectedExam] = useState(null);
  const [subscriptionActive, setSubscriptionActive] = useState(false);

  const studySections = [
    {name:"📌 Current Affairs", color:"#FFD700", raw:"https://raw.githubusercontent.com/Sajanpreetsingh367/Gill-Tarn-taran/main/current_affairs.json"},
    {name:"📝 Practice Questions", color:"#90EE90", raw:"https://raw.githubusercontent.com/Sajanpreetsingh367/Gill-Tarn-taran/main/practice_questions.json"},
    {name:"🧠 Mind Maps", color:"#87CEFA", raw:"https://raw.githubusercontent.com/Sajanpreetsingh367/Gill-Tarn-taran/main/mind_map.json"},
    {name:"📚 Books Summary", color:"#FFB6C1", raw:"https://raw.githubusercontent.com/Sajanpreetsingh367/Gill-Tarn-taran/main/books_summary.json"},
    {name:"🎤 Interview", color:"#FFA07A", raw:"https://raw.githubusercontent.com/Sajanpreetsingh367/Gill-Tarn-taran/main/interview_practise.json"},
    {name:"💬 Discussion", color:"#E6E6FA", raw:"https://raw.githubusercontent.com/Sajanpreetsingh367/Gill-Tarn-taran/main/sdc_news.json"},
    {name:"🎥 Live Classes", color:"#006400", raw:""}, // live class content handled separately
    {name:"🏦 Donation Bank", color:"#D3D3D3", raw:""}, // donation handled separately
    {name:"📖 Vocabulary", color:"#FFE4B5", raw:"https://raw.githubusercontent.com/Sajanpreetsingh367/Gill-Tarn-taran/main/vacubaluray.json"},
  ];

  // ---------------- Auth Functions ----------------
  const handleSignup = async () => {
    const { email,password,username,mobile,pin } = signupData;
    if(!email||!password){alert("Fill all fields"); return;}
    try{
      const { auth, db, createUserWithEmailAndPassword, doc, setDoc } = window._firebase;
      const userCredential = await createUserWithEmailAndPassword(auth,email,password);
      const user = userCredential.user;
      await setDoc(doc(db,"users",user.uid),{username,email,mobile,pin,createdAt:new Date().toISOString()});
      alert("Signup successful ✅");
      setScreen("examlist");
    } catch(err){alert("Signup failed ❌ "+err.message);}
  };

  const handleLogin = async()=>{
    try{
      const { auth, signInWithEmailAndPassword } = window._firebase;
      const { email,password } = loginData;
      await signInWithEmailAndPassword(auth,email,password);
      alert("Login successful ✅");
      setScreen("examlist");
    }catch(err){alert("Login failed ❌ "+err.message);}
  };

  // ---------------- Payment / BIGHIT ----------------
  const openUPI = ()=>{
    const upiLink = "upi://pay?pa=demo@upi&pn=StudyClub&am=99&cu=INR";
    window.location.href = upiLink;
    setTimeout(()=>setScreen("manualVerification"),60000);
  };

  const verifyCode = ()=>{
    const code = document.getElementById("code").value.trim();
    if(code==="BIGHIT"){
      setSubscriptionActive(true);
      alert("Subscription unlocked ✅");
      setScreen("home");
    }else{
      alert("Invalid code ❌");
    }
  };

  // ---------------- Study Section Screens ----------------
  const renderStudyScreen = (section)=>{
    const [data,setData] = useState([]);
    useEffect(()=>{
      if(section.raw) fetch(section.raw).then(res=>res.json()).then(json=>setData(json.images || json)).catch(e=>console.log(e));
    },[section.raw]);
    return(
      <div className="container" style={{backgroundColor:section.color}}>
        <div className="back-button" onClick={()=>setScreen("home")}>🔙</div>
        <div className="section-title">{section.name}</div>
        {data.map((item,i)=>
          <div key={i} className="image-frame">
            <img src={item} alt={`img-${i}`} />
          </div>
        )}
      </div>
    );
  };

  // ---------------- SCREENS ----------------
  if(screen==="welcome") return(
    <div className="container" style={{backgroundColor:"#90EE90"}}>
      <h2>Welcome to Study Discussion Club</h2>
      <p>Developed by Sajan</p>
      <button onClick={()=>setScreen("signup")}>Next</button>
    </div>
  );

  if(screen==="signup"){
    const filled = Object.values(signupData).every(v=>v.trim()!=="");
    return(
      <div className="container" style={{backgroundColor:"#89CFF0"}}>
        <h2>Signup</h2>
        {Object.keys(signupData).map((key)=>(
          <input key={key} placeholder={key.toUpperCase()} type={key==="password"||key==="pin"?"password":"text"} value={signupData[key]} onChange={(e)=>setSignupData({...signupData,[key]:e.target.value})}/>
        ))}
        <button style={{backgroundColor:filled?"#007AFF":"gray",cursor:filled?"pointer":"not-allowed"}} onClick={handleSignup}>Signup</button>
        <p style={{color:"#007AFF",cursor:"pointer"}} onClick={()=>setScreen("login")}>Already have an account?</p>
      </div>
    );
  }

  if(screen==="login")
    return(
      <div className="container" style={{backgroundColor:"#D3D3D3"}}>
        <h2>Login</h2>
        <input placeholder="Email" value={loginData.email} onChange={(e)=>setLoginData({...loginData,email:e.target.value})}/>
        <input type="password" placeholder="Password" value={loginData.password} onChange={(e)=>setLoginData({...loginData,password:e.target.value})}/>
        <button onClick={handleLogin}>Login</button>
      </div>
    );

  if(screen==="examlist")
    return(
      <div className="container" style={{backgroundColor:"#FF7F7F"}}>
        <h2>Select Exam</h2>
        {["UPSC","NEET","JEE","NDA","JUDICIARY"].map((exam)=>(
          <div key={exam} className="exam-box" onClick={()=>setSelectedExam(exam)} style={{backgroundColor:selectedExam===exam?"#FF4500":"#fff"}}>{exam}</div>
        ))}
        <button disabled={!selectedExam} style={{backgroundColor:selectedExam?"#007AFF":"gray",cursor:selectedExam?"pointer":"not-allowed"}} onClick={()=>setScreen("payment")}>Next</button>
      </div>
    );

  if(screen==="payment")
    return(
      <div className="container" style={{backgroundColor:"#FFFACD"}}>
        <h2>Subscription</h2>
        <div className="notice-box">
          ✅ Daily Current Affairs<br/>
          ✅ Daily Practice Questions<br/>
          ✅ Mind Maps<br/>
          ✅ Books Summary<br/>
          ✅ Discussion & Contest Entry
        </div>
        <button onClick={openUPI}>Pay Now</button>
        <input id="code" placeholder="Enter Code (BIGHIT)"/>
        <button onClick={verifyCode}>Submit Code</button>
        <div className="notice-box">
          Dear user, if our app does not receive any payment response, our team will manually verify your payment and activate your subscription.
        </div>
      </div>
    );

  if(screen==="manualVerification")
    return(
      <div className="container" style={{backgroundColor:"#F0F0F0"}}>
        <h2>Manual Verification</h2>
        <input id="uname" placeholder="Full Name"/>
        <input id="umobile" placeholder="Mobile Number"/>
        <input id="uupi" placeholder="Your UPI ID"/>
        <button onClick={()=>{alert("Submitted for verification ✅"); setScreen("home");}}>Submit for Verification</button>
        <div className="notice-box">
          Dear user, our team will verify your payment manually and activate your subscription shortly.
        </div>
      </div>
    );

  if(screen==="home")
    return(
      <div className="container" style={{backgroundColor:"#FFFFE0"}}>
        <h2>Study Discussion Club</h2>
        {studySections.map((sec,i)=>
          <div key={i} className="menu-btn" onClick={()=>setScreen(`section-${i}`)}>{sec.name}</div>
        )}
      </div>
    );

  for(let i=0;i<studySections.length;i++){
    if(screen===`section-${i}`) return renderStudyScreen(studySections[i]);
  }

  return null;
}

ReactDOM.createRoot(document.getElementById("root")).render(<App />);
</script>
</body>
</html>
