<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Study Discussion Club</title>

<script src="https://unpkg.com/react@18/umd/react.development.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getAuth, onAuthStateChanged, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey:"AIzaSyDwbIHTMWM_AQ-NlsdXGDzAfoC8Tf8lZiY",
  authDomain:"study-discussion-club.firebaseapp.com",
  projectId:"study-discussion-club",
  storageBucket:"study-discussion-club.appspot.com",
  messagingSenderId:"383378613377",
  appId:"1:383378613377:web:3b932c6b42076352811980"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

window.F = { auth, db, doc, getDoc, setDoc, onAuthStateChanged, createUserWithEmailAndPassword, signInWithEmailAndPassword };
</script>

<style>
html,body,#root{height:100%;margin:0;padding:0;font-family:"Poppins",sans-serif;background:radial-gradient(circle at 50% 20%,#2a2a72 0%,#000 90%);color:white;display:flex;justify-content:center;align-items:center;}
.centerBox{display:flex;flex-direction:column;align-items:center;text-align:center;padding:20px;}
input{padding:10px;margin:6px;width:90%;max-width:300px;border-radius:8px;border:none;}
.btn{width:100%;padding:12px;margin-top:12px;border:none;border-radius:10px;font-weight:700;font-size:15px;color:#fff;background:linear-gradient(90deg,#6C63FF,#00C2A8);cursor:pointer;}
.btn:disabled{opacity:0.6;cursor:not-allowed;}
</style>
</head>

<body>
<div id="root"></div>

<script type="text/babel">
const { useState, useEffect } = React;
const F = window.F;

function App() {
  const [loading, setLoading] = useState(true); // for initial auth check
  const [user, setUser] = useState(null);
  const [subscribed, setSubscribed] = useState(false);
  const [screen, setScreen] = useState("loading"); // loading / auth / subscription / home

  useEffect(() => {
    // Listen to Firebase Auth State
    const unsubscribe = F.onAuthStateChanged(F.auth, async (u) => {
      if(u){
        setUser(u);
        const docRef = F.doc(F.db,"users",u.uid);
        const docSnap = await F.getDoc(docRef);
        let isSub = false;
        if(docSnap.exists()){
          isSub = docSnap.data().subscribed || false;
        } else {
          await F.setDoc(docRef,{subscribed:false});
        }
        setSubscribed(isSub);
        setScreen(isSub ? "home" : "subscription");
      } else {
        setScreen("auth");
      }
      setLoading(false);
    });
    return ()=>unsubscribe();
  },[]);

  if(loading) return <div className="centerBox"><h2>Loading...</h2></div>;
  if(screen==="auth") return <AuthScreen setUser={setUser}/>;
  if(screen==="subscription") return <SubscriptionScreen user={user} setSubscribed={setSubscribed} setScreen={setScreen}/>;
  if(screen==="home") return <HomeScreen/>;

  return <div className="centerBox">Unknown Screen</div>;
}

// AUTH SCREEN
function AuthScreen({setUser}){
  const [email,setEmail] = useState("");
  const [password,setPassword] = useState("");

  const login = async ()=>{
    try{
      await F.signInWithEmailAndPassword(F.auth,email,password);
    } catch(err){ alert("Login Failed: "+err.message); }
  };
  const signup = async ()=>{
    try{
      const u = await F.createUserWithEmailAndPassword(F.auth,email,password);
      await F.setDoc(F.doc(F.db,"users",u.user.uid),{subscribed:false});
    } catch(err){ alert("Signup Failed: "+err.message); }
  };

  return (
    <div className="centerBox">
      <h2>Login / Signup</h2>
      <input placeholder="Email" value={email} onChange={e=>setEmail(e.target.value)}/>
      <input placeholder="Password" type="password" value={password} onChange={e=>setPassword(e.target.value)}/>
      <button className="btn" onClick={login}>Login</button>
      <button className="btn" onClick={signup}>Signup</button>
    </div>
  );
}

// SUBSCRIPTION SCREEN
function SubscriptionScreen({user,setSubscribed,setScreen}){
  const handlePay = async ()=>{
    if(!user) return alert("Login first!");
    const docRef = F.doc(F.db,"users",user.uid);
    await F.setDoc(docRef,{subscribed:true},{merge:true});
    setSubscribed(true);
    setScreen("home");
  };

  return (
    <div className="centerBox">
      <h2>ðŸ”¥ Unlock Full Access</h2>
      <p>All Study Material + Contests + Quizzes</p>
      <button className="btn" onClick={handlePay}>ðŸ’³ Subscribe â‚¹99 / Month</button>
    </div>
  );
}

// HOME SCREEN
function HomeScreen(){
  return (
    <div className="centerBox">
      <h2>Welcome to Study Discussion Club</h2>
      <p>ðŸŽ¯ Your content will appear here</p>
    </div>
  );
}

ReactDOM.createRoot(document.getElementById("root")).render(<App/>);
</script>
</body>
</html>
