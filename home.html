<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Study Discussion Club</title>

<style>
:root { --accent:#6C63FF; --accent2:#00C2A8;}
*{margin:0;padding:0;box-sizing:border-box;font-family:"Poppins",sans-serif;}
body{
  background:radial-gradient(circle at 50% 20%,#2a2a72 0%,#000 90%);
  color:white;text-align:center;padding:18px;
}
.hidden{display:none;}
.grid{margin-top:25px;display:grid;grid-template-columns:repeat(2,1fr);gap:16px;}
.card{background:rgba(255,255,255,0.08);padding:18px;border-radius:14px;cursor:pointer;transition:0.25s;}
.card:hover{background:rgba(255,255,255,0.18);}
.card img{width:70px;height:70px;margin-bottom:6px;}
.logoutBtn{margin-top:35px;background:linear-gradient(90deg,var(--accent),var(--accent2));border:none;padding:12px 22px;border-radius:10px;color:white;font-weight:700;cursor:pointer;}
.backBtn{position:absolute;left:12px;top:12px;border:none;background:rgba(255,255,255,0.13);padding:8px 14px;border-radius:10px;color:white;cursor:pointer;}
#imgList img{width:100%;border-radius:14px;margin-bottom:20px;border:2px solid rgba(255,255,255,0.2);}
input{width:100%;padding:10px;border-radius:8px;border:none;margin:6px 0;font-size:15px;}
.option{background:rgba(255,255,255,0.15);padding:10px;margin-top:8px;border-radius:10px;cursor:pointer;transition:0.2s;}
.option:hover{background:rgba(255,255,255,0.25);}
.option.selected{background:rgba(0,255,255,0.3);}
</style>
</head>

<body>

<!-- âœ… HOME SCREEN -->
<div id="homeScreen">
  <h2 id="examName">Your Course</h2>
  <p>Select a learning section</p>
  <div class="grid">
    <div class="card" onclick="openSection('current')">
      <img src="https://cdn-icons-png.flaticon.com/512/3135/3135715.png"><div>Current Affairs</div>
    </div>
    <div class="card" onclick="openSection('practice')">
      <img src="https://cdn-icons-png.flaticon.com/512/201/201572.png"><div>Practice Questions</div>
    </div>
    <div class="card" onclick="openSection('mindmap')">
      <img src="https://cdn-icons-png.flaticon.com/512/952/952717.png"><div>Mind Maps</div>
    </div>
    <div class="card" onclick="openSection('interview')">
      <img src="https://cdn-icons-png.flaticon.com/512/3135/3135810.png"><div>Interview Q&A</div>
    </div>
    <div class="card" onclick="openSection('books')">
      <img src="https://cdn-icons-png.flaticon.com/512/942/942748.png"><div>UPSC Book Summary</div>
    </div>
    <div class="card" onclick="openSection('social')">
      <img src="https://cdn-icons-png.flaticon.com/512/1384/1384060.png"><div>Social Media Material</div>
    </div>
    <div class="card" onclick="openSection('contest')">
      <img src="https://cdn-icons-png.flaticon.com/512/1828/1828884.png"><div>Contest</div>
    </div>
  </div>
  <button class="logoutBtn" onclick="logoutUser()">Logout</button>
</div>

<!-- âœ… SECTION SCREEN -->
<div id="sectionScreen" class="hidden">
  <button class="backBtn" onclick="goBack()">â­  Back</button>
  <h2 id="secTitle">Loading...</h2>
  <div id="imgList"></div>
</div>

<!-- âœ… CONTEST SCREEN -->
<div id="contestScreen" class="hidden">
  <button class="backBtn" onclick="goBack()">â­  Back</button>
  <h2>ðŸ”¥ UPSC Contest</h2>

  <div style="background:rgba(255,255,255,0.08);padding:16px;border-radius:14px;margin-top:18px;">
    <input id="aspirantName" placeholder="Aspirant Name"/>
    <input id="fatherName" placeholder="Father Name"/>
    <input id="mobileNo" placeholder="Mobile Number"/>
  </div>

  <button id="startQuizBtn" 
    style="margin-top:25px;background:linear-gradient(90deg,#6C63FF,#00C2A8);
    border:none;padding:12px 22px;border-radius:10px;color:white;font-weight:700;"
    onclick="startQuiz()">
    Start Quiz
  </button>
</div>

<!-- âœ… QUIZ SCREEN -->
<div id="quizScreen" class="hidden">
  <button class="backBtn" onclick="goBack()">â­  Back</button>
  <h2>ðŸ§  UPSC Quiz</h2>
  <div id="quizContainer"></div>
</div>

<script type="module">
// âœ… Supabase setup
import { createClient } from "https://esm.sh/@supabase/supabase-js@2";
const supabaseUrl = "https://zkqegvyxmtwyznizuhjt.supabase.co";
const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InprcWVndnl4bXR3eXpuaXp1aGp0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA2MjkxMDYsImV4cCI6MjA3NjIwNTEwNn0.hC01DVzpgFg_cAVBs-Q6dalvUh1oU5OJ5NxkoEVY36o";
const supabase = createClient(supabaseUrl, supabaseKey);

// âœ… JSON Links
const links = {
  current: "https://raw.githubusercontent.com/Sajanpreet35/Bighit/main/upsc_currentaffairs.json",
  practice: "https://raw.githubusercontent.com/avnoordeepsingh733-svg/Avnoor/main/upsc%20practise%20questions.json",
  mindmap: "https://raw.githubusercontent.com/avnoordeepsingh733-svg/Avnoor/main/mindmaps.json",
  interview: "https://raw.githubusercontent.com/avnoordeepsingh733-svg/Avnoor/main/upscinterviewpractisequestions.json",
  books: "https://raw.githubusercontent.com/Sajanpreet35/Bighit/main/upsc_books.json",
  social: "https://raw.githubusercontent.com/Sajanpreet35/Bighit/main/social_media_material.json"
};

let quizData = [];
let currentIndex = 0;
let score = 0;
let userAnswers = {};

document.getElementById("examName").innerText = (localStorage.getItem("selectedExam") || "UPSC") + " Course";

// âœ… Section open
async function openSection(sec){
  document.getElementById("homeScreen").classList.add("hidden");
  
  if(sec === "contest"){
    document.getElementById("contestScreen").classList.remove("hidden");
    return;
  }

  document.getElementById("sectionScreen").classList.remove("hidden");
  const res = await fetch(links[sec]);
  const data = await res.json();

  document.getElementById("secTitle").innerText = data.title;
  const list = document.getElementById("imgList");
  list.innerHTML = "";
  data.images.forEach(src=>{
    let img = document.createElement("img");
    img.src = src;
    list.appendChild(img);
  });
}

// âœ… Start Quiz
async function startQuiz(){
  const name = document.getElementById("aspirantName").value.trim();
  const father = document.getElementById("fatherName").value.trim();
  const mobile = document.getElementById("mobileNo").value.trim();

  if(!name || !father || !mobile){
    alert("Please fill all details!");
    return;
  }

  document.getElementById("contestScreen").classList.add("hidden");
  document.getElementById("quizScreen").classList.remove("hidden");

  const res = await fetch("https://raw.githubusercontent.com/Sajanpreet35/Upsc-quiz-/main/upsc_quiz.json");
  const data = await res.json();
  quizData = data.questions;
  currentIndex = 0;
  score = 0;
  userAnswers = {};
  showQuestion();
}

function showQuestion(){
  const q = quizData[currentIndex];
  const box = document.getElementById("quizContainer");
  box.innerHTML = `
    <h3>Q${currentIndex+1}/${quizData.length}</h3>
    <img src="${q.image}" style="width:100%;border-radius:12px;margin:10px 0;">
    ${q.options.map(opt => `<div class='option' onclick='selectOption("${opt}")'>${opt}</div>`).join('')}
    <button style="margin-top:20px;background:linear-gradient(90deg,#6C63FF,#00C2A8);
      border:none;padding:12px 22px;border-radius:10px;color:white;font-weight:700;"
      onclick="nextQuestion()">
      ${currentIndex === quizData.length - 1 ? "Submit Quiz" : "Next Question"}
    </button>`;
}

window.selectOption = function(opt){
  const options = document.querySelectorAll(".option");
  options.forEach(o => o.classList.remove("selected"));
  event.target.classList.add("selected");
  userAnswers[currentIndex] = opt;
};

window.nextQuestion = async function(){
  const q = quizData[currentIndex];
  if(!userAnswers[currentIndex]){
    alert("Please select an option!");
    return;
  }
  if(userAnswers[currentIndex] === q.answer){ score++; }

  if(currentIndex < quizData.length - 1){
    currentIndex++;
    showQuestion();
  } else {
    alert(`âœ… Quiz Submitted!\nYour Score: ${score}/${quizData.length}`);
    await supabase.from("responses").insert({
      aspirant_name: document.getElementById("aspirantName").value,
      father_name: document.getElementById("fatherName").value,
      mobile: document.getElementById("mobileNo").value,
      score: score
    });
    goBack();
  }
};

// âœ… Back + Logout
function goBack(){
  document.querySelectorAll("div").forEach(d=>d.classList.add("hidden"));
  document.getElementById("homeScreen").classList.remove("hidden");
}
function logoutUser(){
  localStorage.clear();
  window.location.href="index.html";
}
</script>
</body>
</html>
