<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Study Discussion Club — Home</title>

<!-- React + Babel -->
<script src="https://unpkg.com/react@18/umd/react.development.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getFirestore, collection, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";

const firebaseConfig = {
  apiKey:"AIzaSyDwbIHTMWM_AQ-NlsdXGDzAfoC8Tf8lZiY",
  authDomain:"study-discussion-club.firebaseapp.com",
  projectId:"study-discussion-club",
  storageBucket:"study-discussion-club.appspot.com",
  messagingSenderId:"383378613377",
  appId:"1:383378613377:web:3b932c6b42076352811980"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

window.F = { db, collection, doc, getDoc, setDoc };
window.A = auth;
</script>

<!-- Supabase -->
<script type="module">
import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm";
window.SB = createClient(
  "https://zkqegvyxmtwyznizuhjt.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InprcWVndnl4bXR3eXpuaXp1aGp0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA2MjkxMDYsImV4cCI6MjA3NjIwNTEwNn0.hC01DVzpgFg_cAVBs-Q6dalvUh1oU5OJ5NxkoEVY36o"
);
</script>

<style>
html,body,#root{height:100%;margin:0;padding:0;font-family:"Poppins",sans-serif;background:radial-gradient(circle at 50% 20%,#2a2a72 0%,#000 90%);overflow:auto;color:white;}
*{box-sizing:border-box;}
.centerBox{display:flex;flex-direction:column;align-items:center;text-align:center;padding:20px;}
.card{background:rgba(255,255,255,0.1);backdrop-filter:blur(20px);border-radius:20px;padding:20px;margin:12px 0;width:90%;max-width:400px;box-shadow:0 10px 40px rgba(0,0,0,0.5);}
.btn{width:100%;padding:12px;margin-top:12px;border:none;border-radius:10px;font-weight:700;font-size:15px;color:#fff;background:linear-gradient(90deg,#6C63FF,#00C2A8);box-shadow:0 4px 20px rgba(108,99,255,0.4);cursor:pointer;}
.btn:disabled{opacity:0.6;cursor:not-allowed;}
.backBtn{position:absolute;left:20px;top:20px;font-size:22px;cursor:pointer;color:#00C2A8;}
.tileList{display:flex;flex-direction:column;gap:12px;margin-top:10px;}
.tile{background:rgba(255,255,255,0.08);padding:14px;border-radius:12px;cursor:pointer;box-shadow:0 6px 20px rgba(0,0,0,0.3);text-align:center;}
.tile.selected{background:linear-gradient(90deg,#6C63FF,#00C2A8);}
.imageBox{margin-top:20px;width:100%;border-radius:16px;overflow:hidden;box-shadow:0 8px 30px rgba(0,0,0,0.5);}
.imageBox img{width:100%;display:block;}
.notice{background:rgba(255,255,255,0.05);padding:14px;border-radius:12px;color:#dbeafe;margin-top:14px;text-align:left;font-size:13px;line-height:1.5;}
.section-grid{display:flex;flex-direction:column;gap:14px;margin-top:20px;width:100%;max-width:400px;}
.section-tile{background:rgba(255,255,255,0.08);border-radius:14px;padding:16px;text-align:center;cursor:pointer;box-shadow:0 6px 20px rgba(0,0,0,0.3);}
.timer{font-size:16px;color:#00C2A8;margin:10px 0;}
</style>
</head>

<body>
<div id="root"></div>

<script type="text/babel">
const {useState,useEffect}=React;
const F=window.F;
const A=window.A;
const SB=window.SB;

function App(){
  const [screen,setScreen]=useState("loading");
  const [user,setUser]=useState(null);
  const [subscribed,setSubscribed]=useState(false);

  useEffect(()=>{
    const unsub = A.onAuthStateChanged(async u=>{
      if(u){
        setUser(u);
        const docRef = F.doc(F.db,"users",u.uid);
        const docSnap = await F.getDoc(docRef);
        if(docSnap.exists()){
          setSubscribed(docSnap.data().subscribed || false);
          setScreen(docSnap.data().subscribed?"home":"subscription");
        } else {
          setScreen("subscription");
        }
      } else {
        setScreen("auth");
      }
    });
    return ()=>unsub();
  },[]);

  if(screen==="loading") return <div className="centerBox"><h2>Loading...</h2></div>;

  if(screen==="auth") return <AuthScreen setScreen={setScreen} setUser={setUser} />;

  if(screen==="subscription") return <SubscriptionScreen user={user} setSubscribed={setSubscribed} setScreen={setScreen} />;

  if(screen==="home") return <HomeScreen />;

  return null;
}

function AuthScreen({setScreen,setUser}){
  const [email,setEmail]=useState("");
  const [password,setPassword]=useState("");
  const [mode,setMode]=useState("login");

  const handleAuth=async()=>{
    try{
      if(mode==="login"){
        const res = await A.signInWithEmailAndPassword(A,email,password);
        setUser(res.user);
      } else {
        const res = await A.createUserWithEmailAndPassword(A,email,password);
        setUser(res.user);
        await F.setDoc(F.doc(F.db,"users",res.user.uid),{subscribed:false});
      }
    } catch(e){
      alert(e.message);
    }
  };

  return (
    <div className="centerBox">
      <h2>{mode==="login"?"Login":"Signup"}</h2>
      <input placeholder="Email" value={email} onChange={e=>setEmail(e.target.value)}/>
      <input placeholder="Password" type="password" value={password} onChange={e=>setPassword(e.target.value)}/>
      <button className="btn" onClick={handleAuth}>{mode==="login"?"Login":"Signup"}</button>
      <button className="btn" onClick={()=>setMode(mode==="login"?"signup":"login")}>Switch to {mode==="login"?"Signup":"Login"}</button>
    </div>
  );
}

function SubscriptionScreen({user,setSubscribed,setScreen}){
  const handlePay = async()=>{
    alert("Payment done!");
    setSubscribed(true);
    setScreen("home");
    await F.setDoc(F.doc(F.db,"users",user.uid),{subscribed:true},{merge:true});
  };

  return (
    <div className="centerBox">
      <h2>Subscription Required</h2>
      <p>Buy subscription to access content</p>
      <button className="btn" onClick={handlePay}>Pay ₹10</button>
    </div>
  );
}

function HomeScreen(){
  const sections=["Current Affairs","Practice Questions","Mind Maps","Books Summary","Interview","Discussion","Contest"];
  return (
    <div className="centerBox">
      <h2>Sections</h2>
      <div className="section-grid">
        {sections.map(sec=><div key={sec} className="section-tile">{sec}</div>)}
      </div>
    </div>
  );
}

ReactDOM.createRoot(document.getElementById("root")).render(<App/>);
</script>
</body>
</html>
