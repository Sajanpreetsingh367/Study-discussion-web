<!DOCTYPE html>
<html lang="en">

<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Study Discussion Club</title>

<script src="https://unpkg.com/@supabase/supabase-js@2"></script>

<style>
:root { --accent:#6C63FF; --accent2:#00C2A8;}
*{margin:0;padding:0;box-sizing:border-box;font-family:"Poppins",sans-serif;}
body{
  background:radial-gradient(circle at 50% 20%,#2a2a72 0%,#000 90%);
  color:white;text-align:center;padding:18px;
}
.hidden{display:none;}
.grid{margin-top:25px;display:grid;grid-template-columns:repeat(2,1fr);gap:16px;}
.card{background:rgba(255,255,255,0.08);padding:18px;border-radius:14px;cursor:pointer;transition:0.25s;}
.card:hover{background:rgba(255,255,255,0.18);}
.card img{width:70px;height:70px;margin-bottom:6px;}
.logoutBtn{margin-top:35px;background:linear-gradient(90deg,var(--accent),var(--accent2));
border:none;padding:12px 22px;border-radius:10px;color:white;font-weight:700;cursor:pointer;}
.backBtn{position:absolute;left:12px;top:12px;border:none;
background:rgba(255,255,255,0.13);padding:8px 14px;border-radius:10px;color:white;cursor:pointer;}
#imgList img{width:100%;border-radius:14px;margin-bottom:20px;border:2px solid rgba(255,255,255,0.2);}
.input{width:100%;padding:10px;margin:8px 0;border:none;border-radius:8px;}
.btn{background:linear-gradient(90deg,#ff5858,#ff9e00);padding:10px 20px;border:none;
border-radius:10px;color:white;font-weight:700;cursor:pointer;}
.option{background:rgba(255,255,255,0.08);margin-top:8px;padding:8px;border-radius:8px;cursor:pointer;}
.option:hover{background:rgba(255,255,255,0.18);}
.correct{background:rgba(0,255,0,0.3)!important;}
.wrong{background:rgba(255,0,0,0.3)!important;}
.question-box{background:rgba(255,255,255,0.08);padding:14px;border-radius:12px;margin-top:14px;}
</style>
</head>

<body>

<!-- âœ… HOME SCREEN -->
<div id="homeScreen">
  <h2 id="examName">Your Course</h2>
  <p>Select a learning section</p>
  <div class="grid">
    <div class="card" onclick="openSection('current')">
      <img src="https://cdn-icons-png.flaticon.com/512/3135/3135715.png"><div>Current Affairs</div></div>
    <div class="card" onclick="openSection('practice')">
      <img src="https://cdn-icons-png.flaticon.com/512/201/201572.png"><div>Practice Questions</div></div>
    <div class="card" onclick="openSection('mindmap')">
      <img src="https://cdn-icons-png.flaticon.com/512/952/952717.png"><div>Mind Maps</div></div>
    <div class="card" onclick="openSection('interview')">
      <img src="https://cdn-icons-png.flaticon.com/512/3135/3135810.png"><div>Interview Q&A</div></div>
    <div class="card" onclick="openSection('books')">
      <img src="https://cdn-icons-png.flaticon.com/512/942/942748.png"><div>UPSC Book Summary</div></div>
    <div class="card" onclick="openSection('social')">
      <img src="https://cdn-icons-png.flaticon.com/512/1384/1384060.png"><div>Social Media Material</div></div>
    <div class="card" onclick="openSection('contest')">
      <img src="https://cdn-icons-png.flaticon.com/512/1828/1828884.png"><div>Contest</div></div>
  </div>
  <button class="logoutBtn" onclick="logoutUser()">Logout</button>
</div>

<!-- âœ… SECTION SCREEN -->
<div id="sectionScreen" class="hidden">
  <button class="backBtn" onclick="goBack()">â­  Back</button>
  <h2 id="secTitle">Loading...</h2>
  <div id="imgList"></div>
</div>

<!-- âœ… CONTEST SCREEN -->
<div id="contestScreen" class="hidden">
  <button class="backBtn" onclick="goBack()">â­  Back</button>
  <h2>ðŸ”¥ Contest</h2>
  <div style="background:rgba(255,255,255,0.09);padding:16px;border-radius:14px;margin-top:18px;">
    <p style="font-size:15px;font-weight:600;">Participants Joined: <span id="joinedCount">0</span> / 100000</p>
    <div style="width:100%;height:12px;background:#333;border-radius:8px;margin-top:10px;">
      <div id="progressBar" style="height:100%;background:limegreen;width:0%;border-radius:8px;"></div>
    </div>
  </div>
  <button id="payBtn" style="margin-top:25px;background:linear-gradient(90deg,#ff5858,#ff9e00);
  border:none;padding:12px 22px;border-radius:10px;font-size:16px;font-weight:700;color:white;cursor:pointer;"
  onclick="payEntry()">Pay Entry Fee â‚¹10</button>
  <button id="joinBtn" disabled style="margin-top:15px;background:#555;border:none;
  padding:12px 22px;border-radius:10px;font-size:16px;font-weight:700;color:white;cursor:not-allowed;"
  onclick="joinQuiz()">Join Quiz</button>
</div>

<!-- âœ… QUIZ SCREEN -->
<div id="quizScreen" class="hidden">
  <button class="backBtn" onclick="goBackToContest()">â­  Back</button>
  <h2>ðŸ§  UPSC Contest Quiz</h2>
  <div class="question-box">
    <input class="input" id="aspName" placeholder="Aspirant Name"/>
    <input class="input" id="fatherName" placeholder="Father Name"/>
    <input class="input" id="mobileNo" placeholder="Mobile No"/>
  </div>
  <div id="quizArea"></div>
  <button class="btn" style="margin-top:15px;" onclick="submitQuiz()">Submit Quiz</button>
</div>

<script>
// âœ… SUPABASE CONNECTION
const SUPABASE_URL = "https://zkqegvyxmtwyznizuhjt.supabase.co";
const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InprcWVndnl4bXR3eXpuaXp1aGp0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA2MjkxMDYsImV4cCI6MjA3NjIwNTEwNn0.hC01DVzpgFg_cAVBs-Q6dalvUh1oU5OJ5NxkoEVY36o";
const sb = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

// âœ… JSON Links
const links = {
  current: "https://raw.githubusercontent.com/Sajanpreet35/Bighit/main/upsc_currentaffairs.json",
  practice: "https://raw.githubusercontent.com/avnoordeepsingh733-svg/Avnoor/main/upsc%20practise%20questions.json",
  mindmap: "https://raw.githubusercontent.com/avnoordeepsingh733-svg/Avnoor/main/mindmaps.json",
  interview: "https://raw.githubusercontent.com/avnoordeepsingh733-svg/Avnoor/main/upscinterviewpractisequestions.json",
  books: "https://raw.githubusercontent.com/Sajanpreet35/Bighit/main/upsc_books.json",
  social: "https://raw.githubusercontent.com/Sajanpreet35/Bighit/main/social_media_material.json",
  quiz: "https://raw.githubusercontent.com/Sajanpreet35/Upsc-quiz-/main/upsc_quiz.json"
};

document.getElementById("examName").innerText =
(localStorage.getItem("selectedExam") || "UPSC") + " Course";

// âœ… SECTION OPEN
async function openSection(sec){
  document.getElementById("homeScreen").classList.add("hidden");
  if(sec === "contest"){ openContest(); return; }

  document.getElementById("sectionScreen").classList.remove("hidden");
  let data = await fetch(links[sec]).then(r=>r.json());
  document.getElementById("secTitle").innerText = data.title;
  let list = document.getElementById("imgList");
  list.innerHTML = "";
  data.images.forEach(src=>{
    let i=document.createElement("img");
    i.src=src;list.appendChild(i);
  });
}

// âœ… CONTEST
let joined = 52290, max = 100000;
function openContest(){
  document.getElementById("contestScreen").classList.remove("hidden");
  updateProgress();
}
function updateProgress(){
  let per = (joined/max)*100;
  document.getElementById("joinedCount").innerText = joined;
  document.getElementById("progressBar").style.width = per + "%";
}
function payEntry(){
  alert("âœ… Payment Success (Test Mode)");
  localStorage.setItem("paidEntry","true");
  let btn = document.getElementById("joinBtn");
  btn.disabled = false;
  btn.style.cursor = "pointer";
  btn.style.background = "linear-gradient(90deg,#007bff,#00d4ff)";
}

// âœ… QUIZ
async function joinQuiz(){
  document.getElementById("contestScreen").classList.add("hidden");
  document.getElementById("quizScreen").classList.remove("hidden");
  const data = await fetch(links.quiz).then(r=>r.json());
  const quizDiv = document.getElementById("quizArea");
  quizDiv.innerHTML = "";
  data.questions.forEach((q,idx)=>{
    const box = document.createElement("div");
    box.className="question-box";
    box.innerHTML = `<img src="${q.image}" style="width:100%;border-radius:10px;">
    <div style="margin-top:6px;">Q${idx+1}. ${q.question}</div>`;
    q.options.forEach(opt=>{
      const o=document.createElement("div");
      o.className="option";
      o.innerText=opt;
      o.onclick=()=>{q.selected=opt;highlight(o,box,opt,q.correct)};
      box.appendChild(o);
    });
    quizDiv.appendChild(box);
  });
  window.currentQuiz = data.questions;
}
function highlight(o,box,opt,correct){
  [...box.querySelectorAll(".option")].forEach(x=>x.classList.remove("correct","wrong"));
  if(opt===correct) o.classList.add("correct"); else o.classList.add("wrong");
}
async function submitQuiz(){
  const name=document.getElementById("aspName").value.trim();
  const father=document.getElementById("fatherName").value.trim();
  const mobile=document.getElementById("mobileNo").value.trim();
  if(!name||!father||!mobile) return alert("Please fill all details!");
  let score=0;
  window.currentQuiz.forEach(q=>{if(q.selected===q.correct)score++;});
  await sb.from("responses").insert([{aspirant_name:name,father_name:father,mobile:mobile,score:score}]);
  alert(`âœ… Quiz submitted successfully!\nYour Score: ${score}/${window.currentQuiz.length}`);
  goBackToContest();
}

// âœ… BACK
function goBack(){
  document.getElementById("homeScreen").classList.remove("hidden");
  document.getElementById("sectionScreen").classList.add("hidden");
  document.getElementById("contestScreen").classList.add("hidden");
}
function goBackToContest(){
  document.getElementById("quizScreen").classList.add("hidden");
  document.getElementById("contestScreen").classList.remove("hidden");
}
function logoutUser(){localStorage.clear();window.location.href="index.html";}
</script>
</body>
</html>
