<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Study Discussion Club</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
:root { --accent:#6C63FF; --accent2:#00C2A8;}
*{margin:0;padding:0;box-sizing:border-box;font-family:"Poppins",sans-serif;}
body{
  background:radial-gradient(circle at 50% 20%,#2a2a72 0%,#000 90%);
  color:white;text-align:center;padding:18px;
}
.hidden{display:none;}
.grid{
  margin-top:25px;display:grid;grid-template-columns:repeat(2,1fr);gap:16px;
}
.card{
  background:rgba(255,255,255,0.08);
  padding:18px;border-radius:14px;cursor:pointer;transition:0.25s;
}
.card:hover{background:rgba(255,255,255,0.18);}
.card img{width:70px;height:70px;margin-bottom:6px;}
.logoutBtn{
  margin-top:35px;background:linear-gradient(90deg,var(--accent),var(--accent2));
  border:none;padding:12px 22px;border-radius:10px;color:white;font-weight:700;
  cursor:pointer;
}
.backBtn{
  position:absolute;left:12px;top:12px;border:none;
  background:rgba(255,255,255,0.13);
  padding:8px 14px;border-radius:10px;color:white;cursor:pointer;
}
input{
  width:80%;padding:10px;margin:10px 0;border:none;border-radius:8px;
}
.option{
  background:rgba(255,255,255,0.08);
  margin:8px 0;padding:10px;border-radius:8px;cursor:pointer;
}
.option:hover{background:rgba(255,255,255,0.18);}
button{cursor:pointer;}
</style>
</head>
<body>

<!-- ‚úÖ HOME SCREEN -->
<div id="homeScreen">
  <h2 id="examName">Your Course</h2>
  <p>Select a learning section</p>
  <div class="grid">
    <div class="card" onclick="openSection('current')">
      <img src="https://cdn-icons-png.flaticon.com/512/3135/3135715.png"><div>Current Affairs</div>
    </div>
    <div class="card" onclick="openSection('practice')">
      <img src="https://cdn-icons-png.flaticon.com/512/201/201572.png"><div>Practice Questions</div>
    </div>
    <div class="card" onclick="openSection('mindmap')">
      <img src="https://cdn-icons-png.flaticon.com/512/952/952717.png"><div>Mind Maps</div>
    </div>
    <div class="card" onclick="openSection('interview')">
      <img src="https://cdn-icons-png.flaticon.com/512/3135/3135810.png"><div>Interview Q&A</div>
    </div>
    <div class="card" onclick="openSection('books')">
      <img src="https://cdn-icons-png.flaticon.com/512/942/942748.png"><div>UPSC Book Summary</div>
    </div>
    <div class="card" onclick="openSection('social')">
      <img src="https://cdn-icons-png.flaticon.com/512/1384/1384060.png"><div>Social Media Material</div>
    </div>
    <div class="card" onclick="openSection('contest')">
      <img src="https://cdn-icons-png.flaticon.com/512/1828/1828884.png"><div>Contest</div>
    </div>
  </div>
  <button class="logoutBtn" onclick="logoutUser()">Logout</button>
</div>

<!-- ‚úÖ SECTION SCREEN -->
<div id="sectionScreen" class="hidden">
  <button class="backBtn" onclick="goBack()">‚≠† Back</button>
  <h2 id="secTitle">Loading...</h2>
  <div id="imgList"></div>
</div>

<!-- ‚úÖ CONTEST SCREEN -->
<div id="contestScreen" class="hidden">
  <button class="backBtn" onclick="goBack()">‚≠† Back</button>
  <h2>üî• Contest</h2>
  <p style="font-size:15px;">Participants Joined: <span id="joinedCount">0</span> / 100000</p>
  <div style="width:100%;height:12px;background:#333;border-radius:8px;margin-top:10px;">
    <div id="progressBar" style="height:100%;background:limegreen;width:0%;border-radius:8px;"></div>
  </div>
  <button id="payBtn" style="margin-top:25px;background:linear-gradient(90deg,#ff5858,#ff9e00);border:none;padding:12px 22px;border-radius:10px;font-size:16px;font-weight:700;color:white;"
    onclick="payEntry()">Pay Entry Fee ‚Çπ10</button>
  <button id="joinBtn" disabled style="margin-top:15px;background:#555;border:none;padding:12px 22px;border-radius:10px;font-size:16px;font-weight:700;color:white;cursor:not-allowed;"
    onclick="openContestForm()">Join Quiz</button>
</div>

<!-- ‚úÖ ASPIRANT FORM SCREEN -->
<div id="aspirantFormScreen" class="hidden">
  <h2>Contest Registration</h2>
  <input id="name" placeholder="Full Name"/>
  <input id="father" placeholder="Father's Name"/>
  <input id="mobile" placeholder="Mobile Number"/>
  <button class="logoutBtn" onclick="submitDetails()">Submit Details</button>
  <button id="startBtn" class="hidden logoutBtn" onclick="startQuiz()">Start Quiz</button>
</div>

<!-- ‚úÖ QUIZ SCREEN -->
<div id="quizScreen" class="hidden">
  <button class="backBtn" onclick="exitQuiz()">‚≠† Exit</button>
  <div id="quizBox"></div>
</div>

<!-- ‚úÖ RESULT SCREEN -->
<div id="resultScreen" class="hidden">
  <h2>üéâ Quiz Completed!</h2>
  <p id="scoreText"></p>
  <button class="logoutBtn" onclick="goHome()">Back to Home</button>
</div>

<script>
// SUPABASE CONNECTION
const SUPABASE_URL = "https://zkqegvyxmtwyznizuhjt.supabase.co";
const SUPABASE_KEY = "YOUR_SUPABASE_ANON_KEY"; // replace this
const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

// JSON LINKS
const links = {
  current: "https://raw.githubusercontent.com/Sajanpreet35/Bighit/main/upsc_currentaffairs.json",
  practice: "https://raw.githubusercontent.com/avnoordeepsingh733-svg/Avnoor/main/upsc%20practise%20questions.json",
  mindmap: "https://raw.githubusercontent.com/avnoordeepsingh733-svg/Avnoor/main/mindmaps.json",
  interview: "https://raw.githubusercontent.com/avnoordeepsingh733-svg/Avnoor/main/upscinterviewpractisequestions.json",
  books: "https://raw.githubusercontent.com/Sajanpreet35/Bighit/main/upsc_books.json",
  social: "https://raw.githubusercontent.com/Sajanpreet35/Bighit/main/social_media_material.json",
  contest: "https://raw.githubusercontent.com/Sajanpreet35/Upsc-quiz-/main/upsc_quiz.json"
};

// NAVIGATION
function openSection(sec){
  document.getElementById("homeScreen").classList.add("hidden");
  if(sec==="contest"){ openContest(); return; }
  document.getElementById("sectionScreen").classList.remove("hidden");
  fetch(links[sec]).then(r=>r.json()).then(data=>{
    document.getElementById("secTitle").innerText=data.title||sec;
    let list=document.getElementById("imgList");
    list.innerHTML="";
    (data.images||[]).forEach(src=>{
      let i=document.createElement("img");
      i.src=src;
      list.appendChild(i);
    });
  });
}

// Contest
let joined=53290,max=100000;
function openContest(){
  document.getElementById("contestScreen").classList.remove("hidden");
  let p=(joined/max)*100;
  document.getElementById("joinedCount").innerText=joined;
  document.getElementById("progressBar").style.width=p+"%";
}
function payEntry(){
  alert("‚úÖ Payment Success (Test Mode)");
  document.getElementById("joinBtn").disabled=false;
  document.getElementById("joinBtn").style.background="linear-gradient(90deg,#007bff,#00d4ff)";
  document.getElementById("joinBtn").style.cursor="pointer";
}
function openContestForm(){
  document.getElementById("contestScreen").classList.add("hidden");
  document.getElementById("aspirantFormScreen").classList.remove("hidden");
}

// Save details
async function submitDetails(){
  const name=document.getElementById("name").value.trim();
  const father=document.getElementById("father").value.trim();
  const mobile=document.getElementById("mobile").value.trim();
  if(!name||!father||!mobile){alert("Please fill all fields");return;}
  const {data,error}=await supabase.from("aspirants").insert([{name,father_name:father,mobile}]);
  if(error){alert("‚ùå Failed to Save!");console.log(error);}
  else{alert("‚úÖ Saved Successfully!");document.getElementById("startBtn").classList.remove("hidden");}
}

// QUIZ SYSTEM
let quizData=[],current=0,score=0,userAnswers={};
async function startQuiz(){
  document.getElementById("aspirantFormScreen").classList.add("hidden");
  document.getElementById("quizScreen").classList.remove("hidden");
  const res=await fetch(links.contest);
  quizData=await res.json();
  showQuestion();
}
function showQuestion(){
  let q=quizData[current];
  if(!q)return finishQuiz();
  let box=document.getElementById("quizBox");
  box.innerHTML=`<h3>Q${current+1}. ${q.question}</h3>`;
  for(let opt in q.options){
    let div=document.createElement("div");
    div.className="option";
    div.innerText=`${opt}. ${q.options[opt]}`;
    div.onclick=()=>{userAnswers[q.id]=opt;nextQuestion();};
    box.appendChild(div);
  }
}
function nextQuestion(){
  current++;
  if(current<quizData.length){showQuestion();}
  else finishQuiz();
}
async function finishQuiz(){
  document.getElementById("quizScreen").classList.add("hidden");
  document.getElementById("resultScreen").classList.remove("hidden");
  quizData.forEach(q=>{if(userAnswers[q.id]===q.correct_answer)score++;});
  document.getElementById("scoreText").innerText=`You scored ${score}/${quizData.length}`;
  await supabase.from("contest_result").insert([{name:document.getElementById("name").value,score}]);
}
function exitQuiz(){
  if(confirm("Exit quiz?")){goHome();}
}
function goBack(){
  document.getElementById("homeScreen").classList.remove("hidden");
  document.getElementById("sectionScreen").classList.add("hidden");
  document.getElementById("contestScreen").classList.add("hidden");
}
function goHome(){
  document.querySelectorAll(".hidden").forEach(()=>{});
  location.reload();
}
function logoutUser(){
  localStorage.clear();
  window.location.href="index.html";
}
</script>
</body>
</html>
